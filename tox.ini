[tox]
envlist = py39,py310,py311,py312,lint,mypy,coverage
isolated_build = true

[testenv]
deps = 
    pytest>=7.0.0
    pytest-cov>=4.0.0
    pytest-xdist>=3.0.0
    pytest-mock>=3.10.0
extras = dev
commands = 
    pytest {posargs}

[testenv:lint]
deps = 
    black>=22.0.0
    flake8>=5.0.0
    isort>=5.0.0
commands = 
    black --check --diff sqlitch tests
    isort --check-only --diff sqlitch tests
    flake8 sqlitch tests

[testenv:format]
deps = 
    black>=22.0.0
    isort>=5.0.0
commands = 
    black sqlitch tests
    isort sqlitch tests

[testenv:mypy]
deps = 
    mypy>=1.0.0
    types-setuptools
extras = dev
commands = 
    mypy sqlitch

[testenv:coverage]
deps = 
    pytest>=7.0.0
    pytest-cov>=4.0.0
extras = dev
commands = 
    pytest --cov=sqlitch --cov-report=html --cov-report=xml --cov-report=term-missing --cov-fail-under=80

[testenv:integration]
deps = 
    pytest>=7.0.0
    pytest-cov>=4.0.0
    docker>=6.0.0
extras = dev
commands = 
    pytest tests/integration/ -v

[testenv:unit]
deps = 
    pytest>=7.0.0
    pytest-cov>=4.0.0
extras = dev
commands = 
    pytest tests/unit/ -v

[testenv:compatibility]
deps = 
    pytest>=7.0.0
    pytest-cov>=4.0.0
extras = dev
commands = 
    pytest -m compatibility -v

[testenv:docs]
deps = 
    sphinx>=5.0.0
    sphinx-rtd-theme>=1.2.0
    myst-parser>=0.18.0
extras = docs
commands = 
    sphinx-build -b html docs docs/_build/html

[testenv:clean]
deps = coverage
skip_install = true
commands = 
    coverage erase
    python -c "import shutil; shutil.rmtree('htmlcov', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('.pytest_cache', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('.mypy_cache', ignore_errors=True)"